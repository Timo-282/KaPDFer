<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF → TXT — GitHub Pages</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0}
    body{padding:24px;background:#f7f7fb;color:#111}
    .card{background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(20,20,50,0.06);padding:18px;max-width:900px;margin:auto}
    h1{margin:0 0 8px;font-size:20px}
    label{display:block;margin:12px 0 6px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    button{padding:10px 14px;border-radius:8px;border:0;background:#2563eb;color:#fff;cursor:pointer}
    button[disabled]{opacity:.5;cursor:not-allowed}
    pre{background:#0b1220;color:#dfefff;padding:12px;border-radius:8px;overflow:auto;max-height:240px}
    .log{font-family:monospace;font-size:13px}
    .small{font-size:13px;color:#555}
    .progress{height:10px;background:#e6eefc;border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;width:0%;background:#2563eb}
    footer{margin-top:18px;font-size:13px;color:#666}
    a.download{display:inline-block;margin-left:8px}
  </style>
</head>
<body>
  <div class="card">
    <h1>PDF → TXT</h1>
    <p class="small">Diese Seite läuft komplett im Browser und kann als statische Datei auf GitHub Pages gehostet werden. Es wird nur der direkt aus PDF extrahierte Text verwendet.</p>

    <label for="file">PDF-Datei auswählen</label>
    <input id="file" type="file" accept="application/pdf">

    <div style="margin-top:12px" class="row">
      <button id="start">Text extrahieren</button>
      <a id="downloadLink" class="download" style="display:none">Download TXT</a>
    </div>

    <label style="margin-top:12px">Erkannter Text (Vorschau)</label>
    <pre id="preview">—</pre>

  </div>

  <!-- Bibliotheken (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>

  <script>
    if (window['pdfjsLib']) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';
    }

    const fileInput = document.getElementById('file');
    const startBtn = document.getElementById('start');
    const preview = document.getElementById('preview');
    const downloadLink = document.getElementById('downloadLink');

    async function runExtraction(pdfFile){
      startBtn.disabled = true;
      preview.textContent = 'PDF wird gelesen...';

      const arrayBuffer = await pdfFile.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
      const pageCount = pdf.numPages;
      let fullText = '';

      for (let p=1; p<=pageCount; p++){
        const page = await pdf.getPage(p);
        const textContent = await page.getTextContent();
        const extracted = textContent.items.map(i => i.str).join(' ').trim();
        fullText += `--- Seite ${p} ---\n` + extracted + "\n\n";
        preview.textContent = fullText.slice(0, 2000);
      }

      const blob = new Blob([fullText], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      downloadLink.href = url;
      downloadLink.download = (pdfFile.name || 'extraction').replace(/\.pdf$/i, '') + '.txt';
      downloadLink.textContent = 'TXT herunterladen';
      downloadLink.style.display = 'inline-block';
      preview.textContent = fullText.slice(0, 10000);
      startBtn.disabled = false;
    }

    startBtn.addEventListener('click', ()=>{
      const f = fileInput.files[0];
      if (!f) { alert('Bitte eine PDF-Datei auswählen.'); return; }
      runExtraction(f);
    });

  </script>
</body>
</html>