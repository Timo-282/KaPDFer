<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>PDF zu TXT Konverter</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.12.313/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 40px; }
  button { margin-top: 10px; }
</style>
</head>
<body>
<h1>PDF zu TXT Konverter</h1>

<input type="file" id="pdfInput" accept="application/pdf"><br><br>

<label>
  <input type="radio" name="mode" value="text" checked> Normaler Text
</label>
<label>
  <input type="radio" name="mode" value="ocr"> OCR
</label><br><br>

<button onclick="convertPDF()">Konvertieren & Download</button>

<script>
async function convertPDF() {
    const fileInput = document.getElementById('pdfInput');
    if (fileInput.files.length === 0) {
        alert("Bitte eine PDF-Datei auswählen.");
        return;
    }

    const file = fileInput.files[0];
    const mode = document.querySelector('input[name="mode"]:checked').value;

    let text = "";

    if (mode === "text") {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const content = await page.getTextContent();
            const pageText = content.items.map(item => item.str).join(" ");
            text += pageText + "\n\n";
        }
    } else {
        // OCR-Modus
        const img = await pdfToImage(file);
        text = await ocrImage(img);
    }

    downloadText(text, file.name.replace(/\.pdf$/i, ".txt"));
}

// Hilfsfunktionen
function downloadText(text, filename) {
    const blob = new Blob([text], {type: "text/plain"});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    link.click();
}

// PDF zu Bild (für OCR)
function pdfToImage(file) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = function(e) {
            const typedarray = new Uint8Array(e.target.result);
            pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                pdf.getPage(1).then(page => {
                    const viewport = page.getViewport({scale: 2});
                    const canvas = document.createElement("canvas");
                    const context = canvas.getContext("2d");
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    page.render({canvasContext: context, viewport: viewport}).promise.then(() => {
                        resolve(canvas);
                    });
                });
            });
        };
        reader.readAsArrayBuffer(file);
    });
}

// OCR
async function ocrImage(canvas) {
    const { data: { text } } = await Tesseract.recognize(canvas, 'deu', {
        logger: m => console.log(m)
    });
    return text;
}
</script>
</body>
</html>